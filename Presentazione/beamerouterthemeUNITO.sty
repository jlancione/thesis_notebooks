\mode<presentation>

\setbeamertemplate{background}{
    \begin{tikzpicture}
        \useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
%       \ifnum\thepage=1\relax % show title image only on page 1
%         \node[opacity=0.8] at ($(current page.center) + (0,.2)$){\includegraphics[width=\linewidth, angle=180]{cms_collision.png}}; % SIS100 image
%          %\put(18,35){\includegraphics[width=\linewidth]{cms_collision.png}} % SIS100 image
%       \fi
    \end{tikzpicture}
}

% Title page
\defbeamertemplate*{title page}{UNITO}{
  \vspace*{\fill}
    \begin{beamercolorbox}[wd=\linewidth]{title page header}
        \centering
        \usebeamerfont{title}\inserttitle\par 
        \vspace*{2ex}
        \usebeamerfont{subtitle}\insertsubtitle
    \end{beamercolorbox}
  \vspace*{\fill}
		\begin{tikzpicture}[remember picture,overlay]
			\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
			\fill[color=unitocolor] (-2.7,-3.1) rectangle (\the\paperwidth,-0.1); % red rectangle
      \node[text width=\textwidth] at ($(current page.center) + (0,-3.85)$){
      \parbox{.4\textwidth}{\color{white}
        \small{Candidato:} \\
        \usebeamerfont{author}
        \insertauthor 
        }%
        \hfill
      \parbox{.6\textwidth}{\color{white}
        \small{Relatore:} \\
        Prof. 
        \usebeamerfont{author}Emanuele Roberto Nocera
        }
      };
		\end{tikzpicture}
}
%% Frame title
%\defbeamertemplate*{frametitle}{UNITO}{
%%    \begin{beamercolorbox}[wd=\linewidth,ht=0cm]{frametitle} %\paperheight
%    \begin{beamercolorbox}[wd=10cm,ht=0cm]{frametitle} %\paperheight
%        \begin{tikzpicture}
%%            \useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
%            \useasboundingbox (0,0) rectangle(10cm,\the\paperheight);
%            \ifx\insertframesubtitle\@empty
%                {
%                    \node[anchor=west,black,font=\large\bfseries] at (0.05,0.95){\insertframetitle};
%                }
%            \else
%                {
%                    \node[anchor=west,black,font=\large\bfseries] at (0.05,1.35){\insertframetitle};
%                    \node[anchor=west,black,font=\small\bfseries] at (0.05,0.95){\insertframesubtitle};
%                }
%            \fi
%        \end{tikzpicture}
%    \end{beamercolorbox}
%    \vspace{-1.5em}
%}

%Frame title
\setbeamertemplate{frametitle}{%
	\vskip-35pt \large%30pt
	\begin{minipage}[b][23pt]{80.5mm}%
		\ifx\insertframesubtitle\@empty
			{\flushleft\insertframetitle}%
		\else
			{\flushleft\insertframetitle\newline\normalsize\insertframesubtitle}%
		\fi
	\end{minipage}%
}

% Header
\defbeamertemplate*{headline}{UNITO}{
    \ifnum \insertpagenumber = 1
      \vspace{7.3em}
      \begin{tikzpicture}
        \shade[left color=unitograyA!30, right color=white] (0,\the\paperheight-55) rectangle (\the\paperwidth,\the\paperheight-54); % gray bar north (background for progress bar)
        \put(280,226){\includegraphics[width=0.20\linewidth]{./Images/logo_unito-horizontal.pdf}} % UniTo logo
      \end{tikzpicture}
    \else
      \vspace{7.3em}
      \begin{tikzpicture}
        \shade[left color=unitocolor, right color=unitograyA!30] (0,\the\paperheight-55) rectangle ($(\the\paperwidth/\inserttotalframenumber*\insertframenumber,\the\paperheight-54)$); % progress bar north (red)
        \shade[left color=unitograyA!30, right color=white] ($(\the\paperwidth/\inserttotalframenumber*\insertframenumber,\the\paperheight-55)$) rectangle (\the\paperwidth,\the\paperheight-54); % gray bar north (background for progress bar)
%     \fill[color=unitocolor] (0,\the\paperheight-55) rectangle (0.37,\the\paperheight-54)$); % red segment north
%       \shade[left color=unitograyA!30, right color=white] (0.37,\the\paperheight-55)) rectangle (\the\paperwidth,\the\paperheight-54); % gray bar north
        \put(280,226){\includegraphics[width=0.20\linewidth]{./Images/logo_unito-horizontal.pdf}} % UniTo logo
      \end{tikzpicture}
    \fi
}

% Footer
\defbeamertemplate*{footline}{UNITO}{
	\ifnum \insertpagenumber = 1 
	\else
%		\vspace{-1mm}
		\begin{tikzpicture}[remember picture,overlay]
			\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
      \shade[left color=unitocolor, right color=unitograyA!30] (0,0.4) rectangle ($(\the\paperwidth/\inserttotalframenumber*\insertframenumber,0.44)$); % progress bar south (red)
      \shade[left color=unitograyA!30, right color=white] ($(\the\paperwidth/\inserttotalframenumber*\insertframenumber,0.4)$) rectangle (\the\paperwidth,0.44); % gray bar south
%		\fill[color=unitocolor] (0,0.4) rectangle (0.37,0.44); % orange dot south
%     \shade[left color=unitograyA!30, right color=white] (0.37,0.4) rectangle (\the\paperwidth,0.44); % gray bar south
		\end{tikzpicture}
		\qquad\quad {\fontsize{7}{10}\selectfont Dipartimento di Fisica \hfill\insertauthor\ \hfill\insertdate\ \hfill \insertframenumber\qquad } \vspace*{2.5mm}
	\fi 
}

\mode<all>

% to use custom font
% \usepackage{fontspec}
% \setsansfont{font_name}
